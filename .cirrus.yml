env:
  # Telegram
  TG_CHAT: "@DumprXDumps"
  TG_TOKEN: ENCRYPTED[d97b38fc916f5b418bdee35179170de5a921ccc7aef4bbdf33548a75cdb5e874cfeef6e4869526dd4ebf308a9fcdd2df]
  
  # Gitlab
  PUSH_TO_GITLAB: true
  GITLAB_GROUP: DumprX
  GITLAB_TOKEN: ENCRYPTED[17b1da005e5941730182c79abd96db912c5df6ecd29271b9aa3045d17e674f8f2d8a596cc1373ceba2262911b106e37e]
  GITLAB_INSTANCE: gitlab.com
  
  # Private SSH Key
  PRIV_SSH_KEY: ENCRYPTED[AAAAB3NzaC1yc2EAAAADAQABAAACAQCqeTsGq3yl33b90vmFHh7gEOXhFpmZz3u1xO0ljVvJc47SQcp2ANWL0StWtOeijCjx1oWAX4bjYRn0Mx6m1rv2we1jf4vSLwkM2ndeiJdV1WSKgKjCSc5OK2YrhqfToixRVPAvXx1NlHZPUj0dUVhdaNXcc1hcnER/DnjiUeamHf+SeJCmG31pNkWj2deVWfAsF54upCwS+KEgUMpnIu9Jj1uOw9QO53KiVtCwH8ZkCzWlm66uib0/svSRoRD9oCxAusDG5S4vhaTxAAUVxA40dYJ5bnm6b1tsjvlJqpv0DfbQqJBxrpj0bHFIA+1p4JX7J2N02ZWp6Ui0AHsW+jAqqmTz+NlXWKQ4I7UKoAP+8eLHnDIvfLupCJVMx4cZYSR3pCR+zPzjxushZ8/CWyt3WiiTnEncPzDDJHpf7sW5OtZ3Fj7fcOw/PutNgBmQkj33w9JDK3s5bxSYt6Rj3qMldRQHUZ84/CXN36hik3Pf/CJjMy8p4wayJ9dLf8oRtfGsWUGHWq2mOl3ie1VsQIBrDCFYfkTVnYpJyu/rMxs63qVyLyXLIOAhBd1rPtM7WL/fV/beNY4PgvR0aDHHiG/HMqzAMIjUJC9nOVy075+cog7/02YZbrBXROAWTOFsIxlhxudqqjb1gDLnOIauzEKDzXEW/65Jrrv1QzrJubCTdQ== dian@petanikode.com]

task:
  name: "Firmware Dump by DumprX"
  only_if: $CIRRUS_REPO_OWNER == 'DumprX'
  skip: $CIRRUS_BRANCH == 'main'
  auto_cancellation: $CIRRUS_BRANCH == 'autocancel'
  timeout_in: 120m
  container:
      image: ghcr.io/sushrut1101/docker:arch
      privileged: true
      cpu: 4
      memory: 16G

  Clone_script:
      - git clone --depth=1 --single-branch https://github.com/DumprX/DumprX.git
  
  Set-SSH-Keys_script:
      - mkdir -p ~/.ssh
      - ssh-keyscan -t rsa github.com >> ~/.ssh/known_hosts
      - ssh-keyscan -t rsa gitlab.com >> ~/.ssh/known_hosts
      - ssh-keyscan -t rsa $GITLAB_INSTANCE >> ~/.ssh/known_hosts
      - echo "$PRIV_SSH_KEY" > ~/.ssh/id_rsa
      - chmod 600 ~/.ssh/id_rsa

  Setup_script:
      - git config --global user.name "Sushrut1101"
      - git config --global user.email "guptasushrut@gmail.com"
      - cd DumprX
      - echo "$GITLAB_TOKEN" > .gitlab_token
      - echo "$GITLAB_GROUP" > .gitlab_group
      - echo "$TG_CHAT" > .tg_chat
      - echo "$TG_TOKEN" > .tg_token
      - echo "$GITLAB_INSTANCE" > .gitlab_instance
      - sudo bash setup.sh

  DumprX_script:
      - cd DumprX || echo "Already in the Directory"
      - ./dumper.sh $(< ${CIRRUS_WORKING_DIR}/ROM_URL.txt)
